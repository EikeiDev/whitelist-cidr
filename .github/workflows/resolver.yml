name: Resolve DNS Whitelist

on:
  # 1. –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (–∫–Ω–æ–ø–∫–∞ "Run workflow" –≤ —Ä–∞–∑–¥–µ–ª–µ Actions)
  workflow_dispatch:

  # 2. –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–∫–∞–∂–¥—ã–π —á–∞—Å)
  schedule:
    - cron: "0 */1 * * *"

  # 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –¥–æ–º–µ–Ω–æ–≤
  push:
    paths:
      - "data/domains.txt"

jobs:
  resolve:
    runs-on: ubuntu-latest
    steps:
      # –®–∞–≥ 1: –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: 1. Checkout Repository
        uses: actions/checkout@v4
        # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é,
        # —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ipv4.txt
        with:
          fetch-depth: 0

      # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
      - name: 2. Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip" # –ö—ç—à–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: 3. Install Dependencies
        run: pip install -r requirements.txt

      # –®–∞–≥ 4: –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç
      - name: 4. Run DNS Resolution Script
        run: python resolve_ru_parallel.py

      # –®–∞–≥ 5: –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: 5. Commit and Push Changes
        uses: EndBug/add-and-commit@v9
        with:
          # –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.
          # –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –±—É–¥–µ—Ç, –∫–æ–º–º–∏—Ç –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è.
          add: "data/ipv4.txt data/cidr.txt"

          # –ê–≤—Ç–æ—Ä –∫–æ–º–º–∏—Ç–∞
          author_name: "GitHub Actions Bot"
          author_email: "github-actions[bot]@users.noreply.github.com"

          # –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
          message: "ü§ñ [Bot] Update DNS whitelist"